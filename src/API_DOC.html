<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TaskCircuit API Documentation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f8f9fa; color: #222; margin: 0; padding: 0; }
        .container { max-width: 1100px; margin: 28px auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 12px #0002; padding: 28px; }
        h1, h2, h3 { color: #2a4d7c; }
        h1 { font-size: 2em; margin-bottom: 0.4em; }
        .section { border-bottom: 1px solid #eee; margin-bottom: 1.5em; padding-bottom: 1.5em; }
        .section-header { display: flex; align-items: center; cursor: pointer; user-select: none; }
        .section-toggle { font-size: 0.8em; margin-right: 8px; color: #666; }
        .section-body { margin-top: 8px; }
        .card { background: #f7fbff; border-radius: 8px; margin-bottom: 1em; padding: 16px; border-left: 6px solid #2a4d7c; }
        .card-header { display: flex; align-items: center; justify-content: space-between; cursor: pointer; }
        .card .endpoint { font-weight: bold; font-size: 1.05em; color: #1a355e; }
        .card-toggle { font-size: 0.8em; color: #666; margin-left: 12px; }
        .card-body { margin-top: 10px; }
        .method { display: inline-block; font-size: 0.85em; font-weight: bold; border-radius: 4px; padding: 2px 8px; margin-right: 8px; }
        .method-get { background: #2e8b57; color: #fff; }
        .method-post { background: #007bff; color: #fff; }
        .method-put { background: #ff9800; color: #fff; }
        .method-delete { background: #e53935; color: #fff; }
        .fields-table { width: 100%; border-collapse: collapse; margin: 8px 0; }
        .fields-table th, .fields-table td { border: 1px solid #e0e6ef; padding: 6px 10px; text-align: left; }
        .fields-table th { background: #eaf6ff; }
        .curl, .example, .note { background: #f4f4f4; border-radius: 4px; padding: 10px; margin: 8px 0; font-size: 0.95em; }
        .small { font-size: 0.9em; color: #555; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
        .pill { display: inline-block; padding: 2px 6px; font-size: 0.8em; border-radius: 999px; background: #eef2ff; color: #334; margin-left: 6px; }
    </style>
    <script>
        function toggleSection(id) {
            var body = document.getElementById(id);
            if (!body) return;
            var hidden = body.style.display === 'none';
            body.style.display = hidden ? 'block' : 'none';
            var icon = body.parentElement.querySelector('.section-toggle');
            if (icon) icon.textContent = hidden ? '▾' : '▸';
        }
        function toggleCard(id) {
            var body = document.getElementById(id);
            if (!body) return;
            var hidden = body.style.display === 'none';
            body.style.display = hidden ? 'block' : 'none';
            var icon = body.parentElement.querySelector('.card-toggle');
            if (icon) icon.textContent = hidden ? '▾ details' : '▸ details';
        }
        document.addEventListener('DOMContentLoaded', function () {
            // Collapse all card bodies by default for a smoother overview
            var bodies = document.querySelectorAll('.card-body');
            bodies.forEach(function (b) { b.style.display = 'none'; });
            var cardToggles = document.querySelectorAll('.card-toggle');
            cardToggles.forEach(function (t) { t.textContent = '▸ details'; });
        });
    </script>
</head>
<body>
<div class="container">
    <h1>TaskCircuit API Documentation</h1>
    <div class="note"><strong>Date:</strong> December 22, 2025 — <strong>Time:</strong> 12:00 (local) — <strong>Base URL:</strong> <code>http://localhost:5000/</code></div>
    <div class="note small"><strong>Naming convention:</strong> All JSON APIs are <strong>lenient</strong> about field casing. Wherever you see a field like <code>account_key</code>, the camelCase alias <code>accountKey</code> (or similar) is also accepted, and vice‑versa. The same applies to <code>user_key/userKey</code>, <code>task_id/taskId</code>, <code>pond_id/pondId</code>, <code>species_code/speciesCode</code>, etc.</div>

    <div class="section">
        <div class="section-header" onclick="toggleSection('section-auth')">
            <span class="section-toggle">▾</span>
            <h2>Authentication</h2>
            <span class="pill">auth, tokens, users</span>
        </div>
        <div id="section-auth" class="section-body">
            <div class="card">
                <div class="card-header" onclick="toggleCard('card-auth-signup')">
                    <div class="endpoint"><span class="method method-post">POST</span> /auth/signup</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-auth-signup" class="card-body">
                    <div class="small">Create the first admin user and company. Protected by a master admin password (server env <code>MASTER_ADMIN_PASSWORD</code>).</div>
                    <table class="fields-table">
                        <tr><th>Field</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>master_password</td><td>string</td><td>Yes</td><td>Must match server-side MASTER_ADMIN_PASSWORD env variable</td></tr>
                        <tr><td>company_name</td><td>string</td><td>Yes</td><td>Company / farm name for this account</td></tr>
                        <tr><td>username</td><td>string</td><td>Yes</td><td>Admin login username</td></tr>
                        <tr><td>password</td><td>string</td><td>Yes</td><td>Admin login password (stored base64-encoded)</td></tr>
                        <tr><td>email</td><td>string</td><td>Yes*</td><td>Email or phone required</td></tr>
                        <tr><td>phone</td><td>string</td><td>Yes*</td><td>Email or phone required</td></tr>
                        <tr><td>roles</td><td>array&lt;string&gt;</td><td>No</td><td>Will always include <code>admin</code></td></tr>
                    </table>
                    <div class="curl"><strong>Request:</strong><br><pre>curl -X POST http://localhost:5000/auth/signup \
  -H "Content-Type: application/json" \
  -d '{
    "master_password": "MASTER",
    "company_name": "Acme Farm",
    "username": "owner",
    "password": "secret",
    "email": "owner@example.com"
  }'</pre></div>
                    <div class="example"><strong>Response (201):</strong><br><pre>{
  "success": true,
  "data": {
    "message": "Admin signup validated and saved.",
    "user_id": "64fe...",
    "account_key": "ACC123",
    "user_key": "USR001"
  }
}</pre></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-auth-account-signup')">
                    <div class="endpoint"><span class="method method-post">POST</span> /auth/account/&lt;account_key&gt;/signup</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-auth-account-signup" class="card-body">
                    <div class="small">Create additional users in an existing account. Requires a valid admin Bearer token for that <code>account_key</code>.</div>
                    <table class="fields-table">
                        <tr><th>Header</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>Authorization</td><td>string</td><td>Yes</td><td><code>Bearer ACCESS_TOKEN</code> for an admin of the same account</td></tr>
                    </table>
                    <table class="fields-table">
                        <tr><th>Body field</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>username</td><td>string</td><td>Yes</td><td>Unique within the account</td></tr>
                        <tr><td>password</td><td>string</td><td>Yes</td><td>Plain-text; server stores base64-encoded</td></tr>
                        <tr><td>email</td><td>string</td><td>No*</td><td>Email or phone required</td></tr>
                        <tr><td>phone</td><td>string</td><td>No*</td><td>Email or phone required</td></tr>
                        <tr><td>roles</td><td>array&lt;string&gt;</td><td>No</td><td>e.g. ["worker"]. If omitted, defaults are applied inside <code>build_user</code>.</td></tr>
                        <tr><td>name / first_name / last_name</td><td>string</td><td>No</td><td>Optional profile fields</td></tr>
                    </table>
                    <div class="curl"><pre>curl -X POST http://localhost:5000/auth/account/ACC123/signup \
  -H "Authorization: Bearer ADMIN_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"username":"worker1","password":"pwd","phone":"+910000000"}'</pre></div>
                    <div class="example"><strong>Response (201):</strong><br><pre>{
  "success": true,
  "data": {
    "message": "User signup validated and saved.",
    "user_id": "6501...",
    "account_key": "ACC123",
    "user_key": "USR002"
  }
}</pre></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-auth-login')">
                    <div class="endpoint"><span class="method method-post">POST</span> /auth/login</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-auth-login" class="card-body">
                    <div class="small">Login with username/password, phone/password or email/password. Returns access and refresh tokens with embedded user data.</div>
                    <table class="fields-table">
                        <tr><th>Field</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>username</td><td>string</td><td>No*</td><td>Username, email or phone plus password required</td></tr>
                        <tr><td>phone</td><td>string</td><td>No*</td><td>Alternative identifier</td></tr>
                        <tr><td>email</td><td>string</td><td>No*</td><td>Alternative identifier</td></tr>
                        <tr><td>password</td><td>string</td><td>Yes*</td><td>Required when no refresh_token provided</td></tr>
                    </table>
                    <div class="curl"><strong>Request:</strong><br><pre>curl -X POST http://localhost:5000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"secret"}'</pre></div>
                    <div class="example"><strong>Response (200):</strong><br><pre>{
  "success": true,
  "data": {
    "user_key": "USR001",
    "account_key": "ACC123",
    "roles": ["admin"],
    "settings": {"timezone": "Asia/Kolkata"},
    "subscription": {"subscription_type": "trial", "expiry": 1767225600},
    "user": {
      "user_key": "USR001",
      "username": "admin",
      "email": "admin@example.com",
      "company_name": "Acme Farm",
      "joined_date": 1766385600
    },
    "access_token": "eyJ...",
    "refresh_token": "rftok..."
  }
}</pre></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-auth-token')">
                    <div class="endpoint"><span class="method method-post">POST</span> /auth/token</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-auth-token" class="card-body">
                    <div class="small">Issue access tokens and/or refresh tokens. Three flows are supported:</div>
                    <ol class="small">
                        <li><strong>Access token from refresh token</strong> (<code>type=refresh_token</code> + <code>token</code>)</li>
                        <li><strong>New refresh token</strong> (<code>type=refresh_token</code> + identifier + password)</li>
                        <li><strong>Access token (default)</strong> (identifier + password or <code>refresh_token</code>)</li>
                    </ol>
                    <table class="fields-table">
                        <tr><th>Body field (snake | camel)</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>type</td><td>string</td><td>No</td><td><code>access_token</code> (default) or <code>refresh_token</code></td></tr>
                        <tr><td>token / refreshToken</td><td>string</td><td>Yes*</td><td>JWT refresh token when exchanging (<code>type=refresh_token</code>)</td></tr>
                        <tr><td>refresh_token / refreshToken</td><td>string</td><td>No*</td><td>Alternative key name accepted in default flow</td></tr>
                        <tr><td>username / phone / email</td><td>string</td><td>No*</td><td>One identifier required when issuing new refresh token or access token from credentials</td></tr>
                        <tr><td>password</td><td>string</td><td>No*</td><td>Required with identifier when no refresh token is provided</td></tr>
                        <tr><td>expires_in / expiresIn</td><td>int</td><td>No</td><td>Lifetime in seconds for new access token (default from config if omitted)</td></tr>
                    </table>
                    <div class="curl"><strong>Request (exchange refresh -&gt; access):</strong><br><pre>curl -X POST http://localhost:5000/auth/token \
  -H "Content-Type: application/json" \
  -d '{"type": "refresh_token", "token": "REFRESH_JWT"}'</pre></div>
                    <div class="example"><strong>Response (200, access only):</strong><br><pre>{
  "success": true,
  "data": {
    "access_token": "eyJ...",
    "expires_in": 1703251200
  }
}</pre></div>
                    <div class="example"><strong>Response (200, refresh only):</strong><br><pre>{
  "success": true,
  "data": {
    "refresh_token": "rftok...",
    "expires_in": 1703251200
  }
}</pre></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-auth-account-users')">
                    <div class="endpoint"><span class="method method-get">GET</span> /auth/account/users</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-auth-account-users" class="card-body">
                    <div class="small">List users within the current authenticated account. If caller is admin, returns all users; otherwise returns only the caller.</div>
                    <table class="fields-table">
                        <tr><th>Header</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>Authorization</td><td>string</td><td>Yes</td><td><code>Bearer ACCESS_TOKEN</code></td></tr>
                    </table>
                    <div class="example"><strong>Response (admin caller):</strong><br><pre>{
  "success": true,
  "data": {
    "users": [ { "user_key": "USR001", "username": "admin", ... } ]
  }
}</pre></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-auth-settings')">
                    <div class="endpoint"><span class="method method-get">GET</span> /auth/settings</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-auth-settings" class="card-body">
                    <div class="small">Get or update (<code>PUT</code>) user-level settings and subscription data.</div>
                    <table class="fields-table">
                        <tr><th>Method</th><th>Behavior</th></tr>
                        <tr><td>GET</td><td>Return <code>settings</code> and <code>subscription</code> for current user</td></tr>
                        <tr><td>PUT</td><td>Overwrite <code>settings</code> object for current user</td></tr>
                    </table>
                    <div class="example small"><strong>Response:</strong> <code>{"user_key":..., "account_key":..., "settings": {...}, "subscription": {...}}</code></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-auth-validate')">
                    <div class="endpoint"><span class="method method-get">GET</span> /auth/validate</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-auth-validate" class="card-body">
                    <div class="small">Validate a Bearer token and return user identity, roles, settings and subscription. Useful for frontend bootstrap.</div>
                    <div class="example small"><strong>Response:</strong> <code>{"user_key":..., "account_key":..., "roles": [...], "settings": {...}, "subscription": {...}, "last_active": ...}</code></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-auth-subscriptions')">
                    <div class="endpoint"><span class="method method-get">GET</span> /auth/subscriptions</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-auth-subscriptions" class="card-body">
                    <div class="small">Manage subscriptions. Non-admin: GET only; Admin: can PUT to change subscription for all users in account.</div>
                    <table class="fields-table">
                        <tr><th>Method</th><th>Body</th><th>Notes</th></tr>
                        <tr><td>GET</td><td>-</td><td>Returns current user's subscription (limited fields for non-admin)</td></tr>
                        <tr><td>PUT</td><td><code>{ "subscription": { ... } }</code></td><td>Only allowed for admin; applies to all users of account</td></tr>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-auth-account-company')">
                    <div class="endpoint"><span class="method method-get">GET</span> /auth/account/&lt;account_key&gt;/company</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-auth-account-company" class="card-body">
                    <div class="small">Lightweight company lookup: returns <code>company_name</code> for any account_key that has an admin user.</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-api-auth-me')">
                    <div class="endpoint"><span class="method method-post">POST</span> /api/auth/me</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-api-auth-me" class="card-body">
                    <div class="small">Compatibility endpoint. Validate token and return normalized user object (with <code>id</code>, <code>email</code>, <code>name</code>, etc.).</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-api-auth-refresh')">
                    <div class="endpoint"><span class="method method-post">POST</span> /api/auth/refresh</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-api-auth-refresh" class="card-body">
                    <div class="small">Compatibility endpoint. Accepts <code>refreshToken</code> or <code>token</code> and returns <code>accessToken</code>.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Company -->
    <div class="section">
        <div class="section-header" onclick="toggleSection('section-company')">
            <span class="section-toggle">▾</span>
            <h2>Company</h2>
            <span class="pill">company, admin</span>
        </div>
        <div id="section-company" class="section-body">
            <div class="card">
                <div class="card-header" onclick="toggleCard('card-company-register')">
                    <div class="endpoint"><span class="method method-post">POST</span> /company/register</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-company-register" class="card-body">
                    <div class="small">Register a new company and its first admin user in a single call. Protected by master password.</div>
                    <table class="fields-table">
                        <tr><th>Body field</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>master_password</td><td>string</td><td>Yes</td><td>Must match <code>MASTER_ADMIN_PASSWORD</code> on server</td></tr>
                        <tr><td>company_name</td><td>string</td><td>Yes</td><td>Company name</td></tr>
                        <tr><td>username</td><td>string</td><td>Yes</td><td>Admin username</td></tr>
                        <tr><td>password</td><td>string</td><td>Yes</td><td>Admin password</td></tr>
                        <tr><td>email</td><td>string</td><td>Yes*</td><td>Email or phone required</td></tr>
                        <tr><td>phone</td><td>string</td><td>Yes*</td><td>Email or phone required</td></tr>
                        <tr><td>roles</td><td>array&lt;string&gt;</td><td>No</td><td>Will include <code>admin</code> automatically</td></tr>
                        <tr><td>pincode</td><td>string</td><td>No</td><td>Postal code</td></tr>
                        <tr><td>description</td><td>string</td><td>No</td><td>Free-form description</td></tr>
                    </table>
                    <div class="example small"><strong>Success (201):</strong> <code>{"company":{...},"admin":{...},"access_token":"...","refresh_token":"..."}</code></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-company-get')">
                    <div class="endpoint"><span class="method method-get">GET</span> /company/&lt;account_key&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-company-get" class="card-body">
                    <div class="small">Get full company record for an authenticated user of that account. Requires Bearer token for the same <code>account_key</code>.</div>
                    <div class="example small"><strong>Success:</strong> <code>{"company": {"account_key":..., "company_name":..., "users": [...], "employee_count": N, ...}}</code></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-company-put')">
                    <div class="endpoint"><span class="method method-put">PUT</span> /company/&lt;account_key&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-company-put" class="card-body">
                    <div class="small">Update company metadata. Only the original admin user of the account can call this.</div>
                    <table class="fields-table">
                        <tr><th>Body field</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>company_name</td><td>string</td><td>No</td><td>New company name; propagated to all user docs</td></tr>
                        <tr><td>pincode</td><td>string</td><td>No</td><td>Postal code</td></tr>
                        <tr><td>description</td><td>string</td><td>No</td><td>Description / notes</td></tr>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-company-public')">
                    <div class="endpoint"><span class="method method-get">GET</span> /company/public/&lt;account_key&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-company-public" class="card-body">
                    <div class="small">Public minimal company info: company name, created date, owner (admin user), worker count.</div>
                    <div class="example small"><strong>Response:</strong> <code>{"company": {"account_key":..., "company_name":..., "created_date": "YYYY-MM-DD", "owner": {"user_key":..., "username": ...}, "worker_count": N}}</code></div>
                </div>
            </div>
        </div>
    </div>

    <!-- User -->
    <div class="section">
        <div class="section-header" onclick="toggleSection('section-user')">
            <span class="section-toggle">▾</span>
            <h2>User</h2>
            <span class="pill">profile, settings</span>
        </div>
        <div id="section-user" class="section-body">
            <div class="card">
                <div class="card-header" onclick="toggleCard('card-user-profile')">
                    <div class="endpoint"><span class="method method-get">GET</span> /user/profile</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-user-profile" class="card-body">
                    <div class="small">Return current authenticated user's profile in frontend-friendly shape.</div>
                    <div class="example small"><strong>Response:</strong> <code>{"user": {"id":..., "email":..., "name":..., "role":..., "phone":..., "avatar":..., "permissions": [...], "createdAt":..., "lastLogin":..., "managerId": ...}}</code> (timestamps are rendered in IST on UI, but may be stored as epoch seconds in tokens)</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-user-put-profile')">
                    <div class="endpoint"><span class="method method-put">PUT</span> /user/profile</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-user-put-profile" class="card-body">
                    <div class="small">Update basic profile fields of current user.</div>
                    <table class="fields-table">
                        <tr><th>Body field</th><th>Type</th><th>Notes</th></tr>
                        <tr><td>first_name</td><td>string</td><td>Optional</td></tr>
                        <tr><td>last_name</td><td>string</td><td>Optional</td></tr>
                        <tr><td>dob</td><td>string</td><td>Date of birth, free format</td></tr>
                        <tr><td>address1</td><td>string</td><td>Address line 1</td></tr>
                        <tr><td>address2</td><td>string</td><td>Address line 2</td></tr>
                        <tr><td>pincode</td><td>string</td><td>Postal code</td></tr>
                        <tr><td>timezone</td><td>string</td><td>Also stored under <code>settings.timezone</code></td></tr>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-user-password')">
                    <div class="endpoint"><span class="method method-put">PUT</span> /user/password</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-user-password" class="card-body">
                    <div class="small">Change password for current user.</div>
                    <table class="fields-table">
                        <tr><th>Field</th><th>Type</th><th>Req</th></tr>
                        <tr><td>old_password</td><td>string</td><td>Yes</td></tr>
                        <tr><td>new_password</td><td>string</td><td>Yes</td></tr>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-user-logout')">
                    <div class="endpoint"><span class="method method-post">POST</span> /user/logout</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-user-logout" class="card-body">
                    <div class="small">Invalidate all refresh tokens for current user (logs out from all devices).</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-user-settings')">
                    <div class="endpoint"><span class="method method-put">PUT</span> /user/settings</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-user-settings" class="card-body">
                    <div class="small">Replace entire <code>settings</code> object of current user.</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-user-settings-notifications')">
                    <div class="endpoint"><span class="method method-put">PUT</span> /user/settings/notifications</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-user-settings-notifications" class="card-body">
                    <div class="small">Update only <code>settings.notifications</code> for current user.</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-user-settings-help-support')">
                    <div class="endpoint"><span class="method method-put">PUT</span> /user/settings/help_support</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-user-settings-help-support" class="card-body">
                    <div class="small">Update only <code>settings.help_support</code> for current user.</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-user-list')">
                    <div class="endpoint"><span class="method method-get">GET</span> /user/list</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-user-list" class="card-body">
                    <div class="small">List users of the current account in frontend User shape.</div>
                    <table class="fields-table">
                        <tr><th>Query</th><th>Type</th><th>Notes</th></tr>
                        <tr><td>phone</td><td>bool</td><td>If <code>true</code>, include phone numbers in result</td></tr>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-api-users')">
                    <div class="endpoint"><span class="method method-get">GET</span> /api/users</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-api-users" class="card-body">
                    <div class="small">Compatibility list of users (uses token context for account_key).</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-api-users-user_id')">
                    <div class="endpoint"><span class="method method-get">GET</span> /api/users/&lt;user_id&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-api-users-user_id" class="card-body">
                    <div class="small">Compatibility single user fetch.</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-api-users-create')">
                    <div class="endpoint"><span class="method method-post">POST</span> /api/users</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-api-users-create" class="card-body">
                    <div class="small">Compatibility user creation (wrapper over <code>build_user</code>).</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-api-users-user_id-patch')">
                    <div class="endpoint"><span class="method method-patch">PATCH</span> /api/users/&lt;user_id&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-api-users-user_id-patch" class="card-body">
                    <div class="small">Compatibility partial update of a user.</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-api-users-user_id-delete')">
                    <div class="endpoint"><span class="method method-delete">DELETE</span> /api/users/&lt;user_id&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-api-users-user_id-delete" class="card-body">
                    <div class="small">Compatibility deletion of a user in current account.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tasks / Schedules -->
    <div class="section">
        <div class="section-header" onclick="toggleSection('section-tasks')">
            <span class="section-toggle">▾</span>
            <h2>Tasks / Schedules</h2>
            <span class="pill">tasks, schedules</span>
        </div>
        <div id="section-tasks" class="section-body">
            <div class="card">
                <div class="card-header" onclick="toggleCard('card-task-create')">
                    <div class="endpoint"><span class="method method-post">POST</span> /task/</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-task-create" class="card-body">
                    <div class="small">Create a task assigned to yourself or (if admin) to another user. Returns canonical TaskDTO fields.</div>
                    <table class="fields-table">
                        <tr><th>Body field</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>title</td><td>string</td><td>Yes</td><td>Short summary of the task</td></tr>
                        <tr><td>description</td><td>string</td><td>No</td><td>Details</td></tr>
                        <tr><td>assigned_to</td><td>string</td><td>No</td><td>User key or identifier; defaults to current user</td></tr>
                        <tr><td>task_date</td><td>string</td><td>No</td><td>Defaults to current date in user timezone (<code>YYYY-MM-DD</code> or <code>YYYY-MM-DD HH:MM</code>)</td></tr>
                        <tr><td>end_date</td><td>string</td><td>No</td><td>Defaults to +24h from creation</td></tr>
                        <tr><td>priority</td><td>string|int</td><td>No</td><td><code>normal</code> by default; automatically set to <code>1</code> (critical) if due &lt; 30min</td></tr>
                        <tr><td>reminder</td><td>bool</td><td>No</td><td>Enable or disable reminders</td></tr>
                        <tr><td>reminder_time</td><td>string</td><td>No</td><td>Optional specific time for reminder</td></tr>
                        <tr><td>remind_before</td><td>int</td><td>No</td><td>Minutes before end date to trigger reminder (default 30)</td></tr>
                        <tr><td>recurring</td><td>string</td><td>No</td><td><code>once</code> (default) or other recurrence patterns</td></tr>
                        <tr><td>notes</td><td>string</td><td>No</td><td>Free-form text</td></tr>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-task-list')">
                    <div class="endpoint"><span class="method method-get">GET</span> /task/</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-task-list" class="card-body">
                    <div class="small">List tasks for current user, with meta counters (pending, completed, overdue, etc.).</div>
                    <div class="example small"><strong>Response:</strong> <code>{"meta": {"pending": 5, "completed": 2, ...}, "tasks": [ TaskDTO..., ... ]}</code></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-task-put')">
                    <div class="endpoint"><span class="method method-put">PUT</span> /task/&lt;task_id&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-task-put" class="card-body">
                    <div class="small">Update fields of an existing task. Supports reassignment with history tracking.</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-task-delete')">
                    <div class="endpoint"><span class="method method-delete">DELETE</span> /task/&lt;task_id&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-task-delete" class="card-body">
                    <div class="small">Delete a task by <code>task_id</code> or underlying Mongo <code>_id</code>.</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-task-move')">
                    <div class="endpoint"><span class="method method-post">POST</span> /task/&lt;task_id&gt;/move</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-task-move" class="card-body">
                    <div class="small">Explicitly move a task to a new assignee and append to history. Admin or current assignee only.</div>
                    <table class="fields-table">
                        <tr><th>Field</th><th>Type</th><th>Req</th></tr>
                        <tr><td>new_assignee</td><td>string</td><td>Yes</td></tr>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-api-schedules')">
                    <div class="endpoint"><span class="method method-get">GET</span> /api/schedules</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-api-schedules" class="card-body">
                    <div class="small">Compatibility endpoint. Filter tasks/schedules by pond, assignee, and status. Accepts both camelCase and snake_case query params.</div>
                    <table class="fields-table">
                        <tr><th>Query param (snake | camel)</th><th>Type</th><th>Notes</th></tr>
                        <tr><td>pond_id / pondId</td><td>string</td><td>Filter by pond</td></tr>
                        <tr><td>assigned_to / assignedTo</td><td>string</td><td>Filter by assignee</td></tr>
                        <tr><td>status</td><td>string</td><td>Filter by task status</td></tr>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-api-schedules-post')">
                    <div class="endpoint"><span class="method method-post">POST</span> /api/schedules</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-api-schedules-post" class="card-body">
                    <div class="small">Compatibility creation of schedule; wraps TaskDTO and uses same storage as /task/.</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-api-schedules-sched_id-patch')">
                    <div class="endpoint"><span class="method method-patch">PATCH</span> /api/schedules/&lt;sched_id&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-api-schedules-sched_id-patch" class="card-body">
                    <div class="small">Compatibility partial update of an existing schedule/task.</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-api-schedules-sched_id-delete')">
                    <div class="endpoint"><span class="method method-delete">DELETE</span> /api/schedules/&lt;sched_id&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-api-schedules-sched_id-delete" class="card-body">
                    <div class="small">Compatibility delete of a schedule/task.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Public endpoints -->
    <div class="section">
        <div class="section-header" onclick="toggleSection('section-public')">
            <span class="section-toggle">▾</span>
            <h2>Public (no-auth) endpoints</h2>
        </div>
        <div id="section-public" class="section-body">
            <div class="card">
                <div class="card-header" onclick="toggleCard('card-public-fish')">
                    <div class="endpoint"><span class="method method-get">GET</span> /public/fish</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-public-fish" class="card-body">
                    <div class="small">Return list of fish entities. Optional query: <code>account_key</code> to return fish mapped to that account.</div>
                    <table class="fields-table">
                        <tr><th>Query</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>account_key</td><td>string</td><td>No</td><td>If provided, only fish mapped to this account are returned</td></tr>
                    </table>
                    <div class="curl"><pre>curl -X GET "http://localhost:5000/public/fish?account_key=ACC123"</pre></div>
                    <div class="example"><strong>Response (200):</strong><br><pre>{
  "success": true,
  "data": {
    "fish": [
      {
        "id": "CF001",
        "speciesCode": "CF001",
        "commonName": "Catfish",
        "createdAt": "2025-12-16T10:00:00Z"
      }
    ]
  }
}</pre></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-public-company')">
                    <div class="endpoint"><span class="method method-get">GET</span> /public/company/&lt;account_key&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-public-company" class="card-body">
                    <div class="small">Return minimal company info for an <code>account_key</code>.</div>
                    <table class="fields-table">
                        <tr><th>Path</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>account_key</td><td>string</td><td>Yes</td><td>Company account identifier</td></tr>
                    </table>
                    <div class="example"><strong>Response (200):</strong><br><pre>{
  "success": true,
  "data": {
    "company": {
      "account_key": "ACC123",
      "company_name": "Acme Farm",
      "created_date": "2025-01-10T08:00:00Z",
      "description": "Farm 1"
    }
  }
}</pre></div>
                    <div class="example"><strong>Response (404):</strong> <code>{"success": false, "error": "Company not found"}</code></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-public-user-company')">
                    <div class="endpoint"><span class="method method-get">GET</span> /public/user/company</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-public-user-company" class="card-body">
                    <div class="small">Lookup company name &amp; account_key for a user identifier.</div>
                    <table class="fields-table">
                        <tr><th>Query</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>user_key</td><td>string</td><td>No*</td><td>One of user_key, username, email or phone is required</td></tr>
                        <tr><td>username</td><td>string</td><td>No*</td><td>User's username</td></tr>
                        <tr><td>email</td><td>string</td><td>No*</td><td>User email</td></tr>
                        <tr><td>phone</td><td>string</td><td>No*</td><td>User phone</td></tr>
                    </table>
                    <div class="example"><strong>Response (200):</strong><br><pre>{
  "success": true,
  "data": {
    "account_key": "ACC123",
    "company_name": "Acme Farm"
  }
}</pre></div>
                    <div class="example"><strong>Response (400):</strong> <code>{"success": false, "error": {"identifier": "Provide one of user_key, username, email, or phone"}}</code></div>
                    <div class="example"><strong>Response (404):</strong> <code>{"success": false, "error": "User not found"}</code></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Fish -->
    <div class="section">
        <div class="section-header" onclick="toggleSection('section-fish')">
            <span class="section-toggle">▾</span>
            <h2>Fish</h2>
            <span class="pill">species, analytics</span>
        </div>
        <div id="section-fish" class="section-body">
            <div class="card">
                <div class="card-header" onclick="toggleCard('card-fish-create')">
                    <div class="endpoint"><span class="method method-post">POST</span> /fish/create</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-fish-create" class="card-body">
                    <div class="small">Create static fish entity (metadata). Fish entity is global; mapping to an account happens via batch add or pond events.</div>
                    <table class="fields-table">
                        <tr><th>Body field</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>common_name</td><td>string</td><td>Yes</td><td>Common name, used for duplicate check (case-insensitive)</td></tr>
                        <tr><td>scientific_name</td><td>string</td><td>Yes</td><td>Scientific name, used for duplicate check</td></tr>
                        <tr><td>species_code</td><td>string</td><td>No</td><td>If omitted, server generates a code from name + random key</td></tr>
                        <tr><td>account_key</td><td>string</td><td>No</td><td>Auto-filled from token if present, otherwise left as provided</td></tr>
                        <tr><td>overwrite</td><td>bool (query)</td><td>No</td><td>If true and duplicate species exists, overwrite instead of 409</td></tr>
                        <tr><td>created_at</td><td>datetime</td><td>No</td><td>Server sets current UTC time</td></tr>
                        <tr><td>...</td><td>any</td><td>No</td><td>Any extra fields are stored on the fish document</td></tr>
                    </table>
                    <div class="example"><strong>Response (201):</strong><br><pre>{"success": true, "data": {"species_id": "CF001", "species_code": "CF001"}}</pre></div>
                    <div class="example"><strong>Response (409):</strong> <code>{"success": false, "error": "Fish with the same scientific_name, common_name, or species_code already exists. Use overwrite=true to force."}</code></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-fish-batch-add')">
                    <div class="endpoint"><span class="method method-post">POST</span> /fish/</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-fish-batch-add" class="card-body">
                    <div class="small">Add a batch (single or bulk) for a fish species for the current account - creates analytics batch and ensures mapping.</div>
                    <table class="fields-table">
                        <tr><th>Body field</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>species_code</td><td>string</td><td>Yes</td><td>Must match <code>_id</code> of an existing fish entity</td></tr>
                        <tr><td>count</td><td>int</td><td>Yes</td><td>Number of fish in this batch (&gt; 0)</td></tr>
                        <tr><td>fish_age_in_month</td><td>int</td><td>Yes</td><td>Age in months for this batch</td></tr>
                        <tr><td>fish_weight</td><td>float</td><td>No</td><td>Average fish weight for this batch (kg)</td></tr>
                    </table>
                    <div class="example"><strong>Response (201):</strong><br><pre>{"success": true, "data": {"species_id": "CF001", "event_id": "ACC123-CF001-..."}}</pre></div>
                    <div class="example"><strong>Response (404):</strong> <code>{"success": false, "error": "Fish species not found. Please create the fish entity first."}</code></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-fish-list')">
                    <div class="endpoint"><span class="method method-get">GET</span> /fish/</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-fish-list" class="card-body">
                    <div class="small">List fish entities mapped to current user's account_key with analytics and optional filters. Query params support both snake_case and camelCase.</div>
                    <table class="fields-table">
                        <tr><th>Query (snake | camel)</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>from_date / fromDate</td><td>datetime/string</td><td>No</td><td>Filter by created_at &gt;= from_date (ISO or epoch)</td></tr>
                        <tr><td>to_date / toDate</td><td>datetime/string</td><td>No</td><td>Filter by created_at &lt;= to_date</td></tr>
                        <tr><td>min_size / minSize</td><td>float</td><td>No</td><td>Numeric filters on stored size field</td></tr>
                        <tr><td>max_size / maxSize</td><td>float</td><td>No</td><td>Numeric filters on stored size field</td></tr>
                        <tr><td>min_weight / minWeight</td><td>float</td><td>No</td><td>Numeric filters on stored weight field and analytics</td></tr>
                        <tr><td>max_weight / maxWeight</td><td>float</td><td>No</td><td>Numeric filters on stored weight field and analytics</td></tr>
                        <tr><td>min_count / minCount</td><td>int</td><td>No</td><td>Numeric filters on count</td></tr>
                        <tr><td>max_count / maxCount</td><td>int</td><td>No</td><td>Numeric filters on count</td></tr>
                        <tr><td>common_name / commonName</td><td>string</td><td>No</td><td>Exact match filter</td></tr>
                        <tr><td>scientific_name / scientificName</td><td>string</td><td>No</td><td>Exact match filter</td></tr>
                        <tr><td>species_code / speciesCode</td><td>string</td><td>No</td><td>Exact match filter</td></tr>
                        <tr><td>min_age / minAge</td><td>int</td><td>No</td><td>Filtering within analytics age buckets</td></tr>
                        <tr><td>max_age / maxAge</td><td>int</td><td>No</td><td>Filtering within analytics age buckets</td></tr>
                        <tr><td>avg_n / avgN</td><td>int</td><td>No</td><td>Analytics parameter for averaging</td></tr>
                    </table>
                    <div class="example"><strong>Response (200):</strong> <code>{"success": true, "data": {"fish": [ {"id": "CF001", "speciesCode": "CF001", "commonName": "Catfish", "analytics": {...}} ]}}</code></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-fish-species_id')">
                    <div class="endpoint"><span class="method method-get">GET</span> /fish/&lt;species_id&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-fish-species_id" class="card-body">
                    <div class="small">Get a fish entity with analytics for the current account; only if mapped to the account.</div>
                    <table class="fields-table">
                        <tr><th>Path</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>species_id</td><td>string</td><td>Yes</td><td>Fish species code / id</td></tr>
                    </table>
                    <div class="example"><strong>Response (200):</strong> <code>{"success": true, "data": {"fish": {"id": "CF001", "commonName": "Catfish", "analytics": {...}, "ponds": ["ACC123-001"]}}}</code></div>
                    <div class="example"><strong>Response (404):</strong> <code>{"success": false, "error": "This fish is not present in your farm (not mapped to your account_key)."}</code></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-fish-put')">
                    <div class="endpoint"><span class="method method-put">PUT</span> /fish/&lt;species_id&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-fish-put" class="card-body">
                    <div class="small">Update fish entity fields and optionally add a new analytics batch.</div>
                    <table class="fields-table">
                        <tr><th>Body field</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>common_name</td><td>string</td><td>No</td><td>Update common name</td></tr>
                        <tr><td>scientific_name</td><td>string</td><td>No</td><td>Update scientific name</td></tr>
                        <tr><td>...entity fields...</td><td>any</td><td>No</td><td>Additional updatable fields</td></tr>
                        <tr><td>count</td><td>int</td><td>No*</td><td>Optional; when provided with fish_age_in_month adds a batch</td></tr>
                        <tr><td>fish_age_in_month</td><td>int</td><td>No*</td><td>Required if count is provided</td></tr>
                        <tr><td>fish_weight</td><td>float</td><td>No</td><td>Optional batch weight</td></tr>
                    </table>
                    <div class="example"><strong>Response (200 w/o batch):</strong> <code>{"success": true, "data": {"species_id": "CF001"}}</code></div>
                    <div class="example"><strong>Response (200 with batch):</strong> <code>{"success": true, "data": {"species_id": "CF001", "event_id": "ACC123-CF001-..."}}</code></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-fish-analytics')">
                    <div class="endpoint"><span class="method method-get">GET</span> /fish/analytics</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-fish-analytics" class="card-body">
                    <div class="small">Get analytics for all fish mapped to the account or a specific fish via <code>species_code</code>.</div>
                    <table class="fields-table">
                        <tr><th>Query</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>species_code</td><td>string</td><td>No</td><td>If provided, restricts analytics to one species</td></tr>
                        <tr><td>min_age / max_age</td><td>int</td><td>No</td><td>Filter analytics by age bucket</td></tr>
                        <tr><td>avg_n</td><td>int</td><td>No</td><td>Analytics window parameter</td></tr>
                        <tr><td>min_weight / max_weight</td><td>float</td><td>No</td><td>Filter analytics by weight</td></tr>
                    </table>
                    <div class="example small"><strong>Response:</strong> <code>{"success": true, "data": {"analytics": [ {"species_code": "CF001", "analytics": {...}} ]}}</code></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-fish-species_id-analytics')">
                    <div class="endpoint"><span class="method method-get">GET</span> /fish/&lt;species_id&gt;/analytics</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-fish-species_id-analytics" class="card-body">
                    <div class="small">Get analytics for a specific fish species mapped to your account.</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-fish-fields')">
                    <div class="endpoint"><span class="method method-get">GET</span> /fish/fields</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-fish-fields" class="card-body">
                    <div class="small">Return list of available fish document fields (for dynamic UIs/filters).</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-fish-distinct')">
                    <div class="endpoint"><span class="method method-get">GET</span> /fish/distinct/&lt;field&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-fish-distinct" class="card-body">
                    <div class="small">Return distinct values for a given fish field.</div>
                    <table class="fields-table">
                        <tr><th>Path</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>field</td><td>string</td><td>Yes</td><td>Field name (e.g. common_name, species_code)</td></tr>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-fish-stats')">
                    <div class="endpoint"><span class="method method-get">GET</span> /fish/stats/&lt;field&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-fish-stats" class="card-body">
                    <div class="small">Return basic stats (min, max, avg, etc.) for a numeric fish field.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pond -->
    <div class="section">
        <div class="section-header" onclick="toggleSection('section-pond')">
            <span class="section-toggle">▾</span>
            <h2>Pond</h2>
            <span class="pill">pond, water, mapping</span>
        </div>
        <div id="section-pond" class="section-body">
            <div class="card">
                <div class="card-header" onclick="toggleCard('card-pond-create')">
                    <div class="endpoint"><span class="method method-post">POST</span> /pond/create</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-pond-create" class="card-body">
                    <div class="small">Create a new pond for the authenticated account. If pond_id omitted, server generates <code>&lt;account_key&gt;-NNN</code>.</div>
                    <table class="fields-table">
                        <tr><th>Body field</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>pond_id</td><td>string</td><td>No</td><td>If omitted, auto-generated per account (001, 002,...)</td></tr>
                        <tr><td>pond_name</td><td>string</td><td>No</td><td>Human-readable name</td></tr>
                        <tr><td>location</td><td>string</td><td>No</td><td>Free-form location string</td></tr>
                        <tr><td>size</td><td>string|number</td><td>No</td><td>Pond size (e.g. area or capacity)</td></tr>
                        <tr><td>water_type</td><td>string</td><td>No</td><td>Freshwater, brackish, etc.</td></tr>
                        <tr><td>...</td><td>any</td><td>No</td><td>Extra fields are persisted</td></tr>
                    </table>
                    <div class="example small"><strong>Response (201):</strong> PondDTO shape with <code>pond_id</code>, <code>account_key</code>, <code>created_at</code>, etc.</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-pond-update')">
                    <div class="endpoint"><span class="method method-put">PUT</span> /pond/update/&lt;pond_id&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-pond-update" class="card-body">
                    <div class="small">Update limited fields on a pond (cannot change pond_id/account_key).</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-pond-get')">
                    <div class="endpoint"><span class="method method-get">GET</span> /pond/&lt;pond_id&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-pond-get" class="card-body">
                    <div class="small">Get a single pond for the current account.</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-pond-put')">
                    <div class="endpoint"><span class="method method-put">PUT</span> /pond/&lt;pond_id&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-pond-put" class="card-body">
                    <div class="small">Update pond document fields for the current account (less strict than /update).</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-pond-delete')">
                    <div class="endpoint"><span class="method method-delete">DELETE</span> /pond/&lt;pond_id&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-pond-delete" class="card-body">
                    <div class="small">Delete a pond by pond_id for the current account.</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-pond-list')">
                    <div class="endpoint"><span class="method method-get">GET</span> /pond/</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-pond-list" class="card-body">
                    <div class="small">List ponds for the authenticated account with pagination and filters.</div>
                    <table class="fields-table">
                        <tr><th>Query</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>limit</td><td>int</td><td>No</td><td>Max items (default 100, max 1000)</td></tr>
                        <tr><td>skip</td><td>int</td><td>No</td><td>Offset for pagination</td></tr>
                        <tr><td>from_date / to_date</td><td>datetime/string</td><td>No</td><td>Date filters on created_at</td></tr>
                        <tr><td>...</td><td>string</td><td>No</td><td>Any other field filters directly on pond document</td></tr>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-pond-fish-options')">
                    <div class="endpoint"><span class="method method-get">GET</span> /pond/&lt;pond_id&gt;/fish_options</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-pond-fish-options" class="card-body">
                    <div class="small">Return simple list of fish options mapped to the account, for UI dropdowns.</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-pond-activity')">
                    <div class="endpoint"><span class="method method-get">GET</span> /pond/&lt;pond_id&gt;/activity</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-pond-activity" class="card-body">
                    <div class="small">Paginated fish_activity / sampling records for a pond. Accepts both snake_case and camelCase query fields.</div>
                    <table class="fields-table">
                        <tr><th>Query (snake | camel)</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>fish_id / fishId</td><td>string</td><td>No</td><td>Filter by fish species id</td></tr>
                        <tr><td>limit</td><td>int</td><td>No</td><td>Default 50</td></tr>
                        <tr><td>skip</td><td>int</td><td>No</td><td>Default 0</td></tr>
                        <tr><td>start_date / startDate</td><td>datetime/string</td><td>No</td><td>Filter by created_at range (start)</td></tr>
                        <tr><td>end_date / endDate</td><td>datetime/string</td><td>No</td><td>Filter by created_at range (end)</td></tr>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-pond-history')">
                    <div class="endpoint"><span class="method method-get">GET</span> /pond/&lt;pond_id&gt;/history</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-pond-history" class="card-body">
                    <div class="small">Combined history for a pond: events, activities, and analytics. All filters accept both snake_case and camelCase naming.</div>
                    <table class="fields-table">
                        <tr><th>Query (snake | camel)</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>start_date / startDate</td><td>datetime/string</td><td>No</td><td>Date window start for all sources</td></tr>
                        <tr><td>end_date / endDate</td><td>datetime/string</td><td>No</td><td>Date window end for all sources</td></tr>
                        <tr><td>species_code / speciesCode</td><td>string</td><td>No</td><td>Filter history for a single fish species</td></tr>
                        <tr><td>include_events / includeEvents</td><td>bool</td><td>No</td><td>Default true</td></tr>
                        <tr><td>include_activities / includeActivities</td><td>bool</td><td>No</td><td>Default true</td></tr>
                        <tr><td>include_analytics / includeAnalytics</td><td>bool</td><td>No</td><td>Default true</td></tr>
                        <tr><td>limit</td><td>int</td><td>No</td><td>Max items per section (default 100)</td></tr>
                        <tr><td>skip</td><td>int</td><td>No</td><td>Offset per section (default 0)</td></tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Pond Events (add/sell/sample/remove/shift_in/shift_out) -->
    <div class="section">
        <div class="section-header" onclick="toggleSection('section-pond-events')">
            <span class="section-toggle">▾</span>
            <h2>Pond Events</h2>
            <span class="pill">events, history</span>
        </div>
        <div id="section-pond-events" class="section-body">
            <div class="card">
                <div class="card-header" onclick="toggleCard('card-pond-event-add')">
                    <div class="endpoint"><span class="method method-post">POST</span> /pond_event/&lt;pond_id&gt;/event/&lt;event_type&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-pond-event-add" class="card-body">
                    <div class="small">Supported <code>event_type</code>: add, sell, sample, remove, shift_in, shift_out. Updates pond metadata, fish analytics, and mapping.</div>
                    <table class="fields-table">
                        <tr><th>Path</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>pond_id</td><td>string</td><td>Yes</td><td>Pond identifier</td></tr>
                        <tr><td>event_type</td><td>string</td><td>Yes</td><td>One of add, sell, sample, remove, shift_in, shift_out</td></tr>
                    </table>
                    <table class="fields-table">
                        <tr><th>Body field</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>fish_id</td><td>string</td><td>Yes</td><td>Fish species id</td></tr>
                        <tr><td>count</td><td>int</td><td>Yes</td><td>&gt; 0</td></tr>
                        <tr><td>fish_age_in_month</td><td>int</td><td>Yes*</td><td>Required for add/shift_in events</td></tr>
                        <tr><td>details</td><td>object</td><td>No</td><td>Arbitrary extra info</td></tr>
                        <tr><td>timestamp</td><td>datetime/string</td><td>No</td><td>If omitted, server uses current time</td></tr>
                        <tr><td>samples</td><td>array</td><td>No</td><td>For sample/add events, weight samples etc.</td></tr>
                    </table>
                    <div class="example"><strong>Response (201):</strong> <code>{"success": true, "data": {"event_id": "..."}}</code></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-pond-event-list')">
                    <div class="endpoint"><span class="method method-get">GET</span> /pond_event/&lt;pond_id&gt;/events</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-pond-event-list" class="card-body">
                    <div class="small">Get all events for a pond (normalized DTO where possible).</div>
                    <div class="example small"><strong>Response:</strong> <code>{"success": true, "data": {"events": [ PondEventDTO..., ... ]}}</code></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-pond-event-delete')">
                    <div class="endpoint"><span class="method method-delete">DELETE</span> /pond_event/&lt;pond_id&gt;/events/&lt;event_id&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-pond-event-delete" class="card-body">
                    <div class="small">Delete an existing pond event by ObjectId.</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-pond-event-put')">
                    <div class="endpoint"><span class="method method-put">PUT</span> /pond_event/&lt;pond_id&gt;/events/&lt;event_id&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-pond-event-put" class="card-body">
                    <div class="small">Update a pond event and reconcile pond metadata + analytics (reverts old effects and applies new ones).</div>
                    <table class="fields-table">
                        <tr><th>Body field</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>fish_id</td><td>string</td><td>No</td><td>New fish species id</td></tr>
                        <tr><td>count</td><td>int</td><td>No</td><td>New count (&gt; 0)</td></tr>
                        <tr><td>event_type</td><td>string</td><td>No</td><td>New event type</td></tr>
                        <tr><td>details</td><td>object</td><td>No</td><td>Updated details</td></tr>
                        <tr><td>fish_age_in_month</td><td>int</td><td>No</td><td>Updated age</td></tr>
                        <tr><td>samples</td><td>array</td><td>No</td><td>For sample/add events, new samples</td></tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Feeding & Sampling -->
    <div class="section">
        <div class="section-header" onclick="toggleSection('section-feeding-sampling')">
            <span class="section-toggle">▾</span>
            <h2>Feeding &amp; Sampling</h2>
            <span class="pill">feeding, sampling</span>
        </div>
        <div id="section-feeding-sampling" class="section-body">
            <div class="card">
                <div class="card-header" onclick="toggleCard('card-feeding-create')">
                    <div class="endpoint"><span class="method method-post">POST</span> /feeding/</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-feeding-create" class="card-body">
                    <div class="small">Record feeding for a pond.</div>
                    <table class="fields-table">
                        <tr><th>Body field</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>pondId</td><td>string</td><td>Yes</td><td>Pond identifier</td></tr>
                        <tr><td>feedType</td><td>string</td><td>No</td><td>Feed description/type</td></tr>
                        <tr><td>quantity</td><td>float</td><td>No</td><td>Quantity fed</td></tr>
                        <tr><td>feedingTime</td><td>datetime/string</td><td>No</td><td>Time of feeding; if omitted, server may use created_at</td></tr>
                        <tr><td>recordedBy</td><td>string</td><td>No</td><td>Set automatically from token user_key</td></tr>
                        <tr><td>...</td><td>any</td><td>No</td><td>Additional DTO-supported fields</td></tr>
                    </table>
                    <div class="example small"><strong>Response (201):</strong> FeedingRecordDTO with <code>id</code>, <code>pondId</code>, <code>feedType</code>, <code>quantity</code>, <code>feedingTime</code>, <code>recordedBy</code>.</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-feeding-list')">
                    <div class="endpoint"><span class="method method-get">GET</span> /feeding/</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-feeding-list" class="card-body">
                    <div class="small">List feeding records, optionally filtered by pond.</div>
                    <table class="fields-table">
                        <tr><th>Query</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>pondId / pond_id</td><td>string</td><td>No</td><td>Filter by pond</td></tr>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-feeding-pond-id')">
                    <div class="endpoint"><span class="method method-get">GET</span> /feeding/pond/&lt;pond_id&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-feeding-pond-id" class="card-body">
                    <div class="small">List feeding records for a specific pond (no auth enforced here).</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-api-feeding')">
                    <div class="endpoint"><span class="method method-post">POST</span> /api/feeding</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-api-feeding" class="card-body">
                    <div class="small">Compatibility endpoint, same as <code>POST /feeding/</code>.</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-api-feeding-get')">
                    <div class="endpoint"><span class="method method-get">GET</span> /api/feeding</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-api-feeding-get" class="card-body">
                    <div class="small">Compatibility endpoint, same as <code>GET /feeding/</code>.</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-api-feeding-pond-id')">
                    <div class="endpoint"><span class="method method-get">GET</span> /api/feeding/pond/&lt;pond_id&gt;</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-api-feeding-pond-id" class="card-body">
                    <div class="small">Compatibility endpoint, same as <code>GET /feeding/pond/&lt;pond_id&gt;</code>.</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" onclick="toggleCard('card-sampling-create')">
                    <div class="endpoint"><span class="method method-post">POST</span> /sampling/</div>
                    <span class="card-toggle">▾ details</span>
                </div>
                <div id="card-sampling-create" class="card-body">
                    <div class="small">Create sampling/growth records (uses GrowthRecordDTO internally).</div>
                    <table class="fields-table">
                        <tr><th>Body field</th><th>Type</th><th>Req</th><th>Notes</th></tr>
                        <tr><td>pondId</td><td>string</td><td>Yes</td><td>Pond identifier</td></tr>
                        <tr><td>species</td><td>string</td><td>Yes</td><td>Fish species code/id</td></tr>
                        <tr><td>sampleSize</td><td>int</td><td>No</td><td>Number of fish sampled</td></tr>
                        <tr><td>averageWeight</td><td>float</td><td>No</td><td>Average weight from samples</td></tr>
                        <tr><td>...</td><td>any</td><td>No</td><td>Other DTO-supported growth fields</td></tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="note small">Note: Server normalizes MongoDB types in responses — ObjectId -> string, datetime -> ISO string. You can click each section title to expand/collapse groups, and click "details" on each endpoint to view or hide full request/response documentation.</div>
    <p><strong>Note:</strong> All timestamps are in IST (Asia/Kolkata) unless otherwise specified.</p>
</div>
</body>
</html>
